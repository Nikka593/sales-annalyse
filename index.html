<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å…¥ä¼šæ•°åˆ†æ</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            margin: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        .container {
            max-width: 1600px;
            margin: 0 auto;
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 15px 35px rgba(0,0,0,0.1);
        }
        h1 {
            text-align: center;
            color: #2c3e50;
            margin-bottom: 30px;
            font-size: 2.5em;
            font-weight: 300;
        }
        .charts-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 30px;
        }
        .chart-container {
            position: relative;
            height: 500px;
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
        }
        .chart-title {
            text-align: center;
            font-size: 1.3em;
            color: #34495e;
            margin-bottom: 15px;
            font-weight: 500;
        }
        .analysis-section {
            background: linear-gradient(135deg, #74b9ff 0%, #0984e3 100%);
            color: white;
            padding: 25px;
            border-radius: 15px;
            margin: 30px 0;
        }
        .analysis-title {
            font-size: 1.5em;
            margin-bottom: 20px;
            text-align: center;
        }
        .period-analysis {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        .period-card {
            background: rgba(255, 255, 255, 0.1);
            padding: 20px;
            border-radius: 10px;
            backdrop-filter: blur(10px);
        }
        .period-title {
            font-size: 1.2em;
            font-weight: bold;
            margin-bottom: 15px;
            text-align: center;
        }
        .growth-stat {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin: 8px 0;
            padding: 8px 12px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 5px;
        }
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }
        .stat-card {
            background: linear-gradient(135deg, #00b894 0%, #00a085 100%);
            color: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            box-shadow: 0 8px 20px rgba(0,0,0,0.1);
        }
        .stat-number {
            font-size: 2.2em;
            font-weight: bold;
            margin-bottom: 8px;
        }
        .stat-label {
            font-size: 0.9em;
            opacity: 0.9;
        }
        .legend-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 10px;
            margin: 20px 0;
        }
        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 12px;
            background: #f8f9fa;
            border-radius: 6px;
            font-size: 0.9em;
        }
        .legend-color {
            width: 16px;
            height: 16px;
            border-radius: 3px;
        }
        .highlight {
            background: linear-gradient(135deg, #fdcb6e 0%, #e17055 100%);
            color: white;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            text-align: center;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ“ˆ å…¥ä¼šæ•°ç´¯ç©åˆ†æ</h1>
        
        <div class="legend-grid" id="legendContainer">
        </div>

        <div class="charts-grid">
            <div class="chart-container">
                <div class="chart-title">å…¨7ç³»åˆ—ã®å…¥ä¼šæ•°æ¨ç§»</div>
                <canvas id="membershipChart"></canvas>
            </div>
        </div>

        <div class="stats-grid" id="statsContainer">
        </div>

        <div class="analysis-section">
            <div class="analysis-title">ğŸ“Š æœŸé–“åˆ¥å…¥ä¼šç‡å¢—åŠ åˆ†æ</div>
            <div class="period-analysis" id="periodAnalysis">
            </div>
        </div>
    </div>

    <script>
        // ãƒ‡ãƒ¼ã‚¿å®šç¾©
        const weeks = ['-8é€±', '-7é€±', '-6é€±', '-5é€±', '-4é€±', '-3é€±', 'èª¿æ•´', '-2é€±', '-1é€±', 
                      'ç¬¬1é€±', 'ç¬¬2é€±', 'ç¬¬3é€±', 'ç¬¬4é€±', 'ç¬¬5é€±', 'ç¬¬6é€±', 'ç¬¬7é€±', 'ç¬¬8é€±', 
                      'ç¬¬9é€±', 'ç¬¬10é€±', 'ç¬¬11é€±', 'ç¬¬12é€±', 'ç¬¬13é€±'];

        const membershipData = [
            [13, 42, 80, 109, 133, 152, null, 171, 189, 210, 220, 237, 260, 294, 319, 333, 350, 361, 370, 379, 382, null],
            [9, 38, 60, 89, 111, 129, null, 158, 180, 196, 223, 234, 251, 261, 265, 273, 277, 288, 295, 301, 304, null],
            [10, 36, 59, 79, 102, 121, null, 139, 168, 186, 203, 218, 232, 238, 244, 256, 267, 276, 292, 304, 318, 321],
            [10, 40, 64, 92, 118, 144, null, 174, 189, 207, 217, 235, 254, 267, 290, 312, 332, 339, 344, 351, 355, 356],
            [9, 28, 49, 66, 84, 103, null, 121, 146, 162, 177, 189, 199, 209, 228, 244, 258, 273, 287, 302, 320, 322],
            [2, 9, 20, 36, 47, 64, null, 75, 115, 128, 150, 158, 161, 178, 200, 217, 236, 256, 272, 290, null, null],
            [11, 32, 61, 86, 108, 141, null, 159, 203, 228, 250, 264, 285, 307, 328, 334, 352, 362, 368, 374, null, null]
        ];

        const companyNames = [
            'æ ªå¼ä¼šç¤¾ã‚¨ã‚¯ã‚¹ãƒ†ã‚£ãƒ¼ãƒ‰',
            'æ ªå¼ä¼šç¤¾G7ãƒªãƒ†ãƒ¼ãƒ«ã‚¸ãƒ£ãƒ‘ãƒ³',
            'ãƒ¢ãƒªã‚¹ã‚¹ãƒã‚¤ãƒ«æ ªå¼ä¼šç¤¾',
            'æ ªå¼ä¼šç¤¾ã‚­ãƒ¼ãƒˆã‚¹',
            'æ ªå¼ä¼šç¤¾ãƒãƒãƒ€',
            'ãƒ¢ãƒªã‚¹ã‚¹ãƒã‚¤ãƒ«æ ªå¼ä¼šç¤¾',
            'æ ªå¼ä¼šç¤¾ã‚­ãƒ¼ãƒˆã‚¹'
        ];

        const colors = [
            '#e74c3c', '#3498db', '#2ecc71', '#f39c12', 
            '#9b59b6', '#e67e22', '#1abc9c'
        ];

        // ãƒãƒ£ãƒ¼ãƒˆãƒ‡ãƒ¼ã‚¿æº–å‚™
        function prepareChartData() {
            return membershipData.map((series, index) => {
                const processedData = [];
                series.forEach((value, weekIndex) => {
                    if (value !== null) {
                        processedData.push({
                            x: weeks[weekIndex],
                            y: value
                        });
                    }
                });
                
                return {
                    label: companyNames[index],
                    data: processedData,
                    borderColor: colors[index],
                    backgroundColor: colors[index] + '20',
                    borderWidth: 3,
                    fill: false,
                    tension: 0.4,
                    pointBackgroundColor: colors[index],
                    pointBorderColor: '#ffffff',
                    pointBorderWidth: 2,
                    pointRadius: 4,
                    pointHoverRadius: 7
                };
            });
        }

        // æœŸé–“åˆ¥åˆ†æè¨ˆç®—
        function calculatePeriodGrowth() {
            const periods = [
                { name: 'ç¬¬1é€±ã€œç¬¬4é€±', startIdx: 9, endIdx: 12 },
                { name: 'ç¬¬5é€±ã€œç¬¬9é€±', startIdx: 13, endIdx: 17 },
                { name: 'ç¬¬10é€±ã€œç¬¬13é€±', startIdx: 18, endIdx: 21 }
            ];

            const results = [];

            periods.forEach(period => {
                const periodResult = {
                    name: period.name,
                    series: []
                };

                membershipData.forEach((series, seriesIndex) => {
                    const startValue = series[period.startIdx];
                    const endValue = series[period.endIdx];
                    
                    if (startValue !== null && endValue !== null) {
                        const growth = endValue - startValue;
                        const growthRate = startValue > 0 ? ((endValue - startValue) / startValue * 100) : 0;
                        
                        periodResult.series.push({
                            companyName: companyNames[seriesIndex],
                            startValue,
                            endValue,
                            growth,
                            growthRate: growthRate.toFixed(1)
                        });
                    }
                });

                results.push(periodResult);
            });

            return results;
        }

        // ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°
        const chartData = prepareChartData();
        const ctx = document.getElementById('membershipChart').getContext('2d');
        
        new Chart(ctx, {
            type: 'line',
            data: {
                datasets: chartData
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                interaction: {
                    intersect: false,
                    mode: 'index'
                },
                plugins: {
                    legend: {
                        display: false
                    },
                    tooltip: {
                        backgroundColor: 'rgba(0, 0, 0, 0.8)',
                        titleColor: '#ffffff',
                        bodyColor: '#ffffff',
                        borderColor: '#ffffff',
                        borderWidth: 1,
                        cornerRadius: 8,
                        displayColors: true,
                        callbacks: {
                            title: function(context) {
                                return context[0].label + 'ã®ç´¯ç©å…¥ä¼šæ•°';
                            },
                            label: function(context) {
                                return context.dataset.label + ': ' + context.parsed.y + 'äºº';
                            }
                        }
                    }
                },
                scales: {
                    x: {
                        type: 'category',
                        grid: {
                            color: 'rgba(0, 0, 0, 0.1)',
                            drawBorder: false
                        },
                        ticks: {
                            color: '#666666',
                            maxRotation: 45,
                            minRotation: 45
                        }
                    },
                    y: {
                        beginAtZero: true,
                        grid: {
                            color: 'rgba(0, 0, 0, 0.1)',
                            drawBorder: false
                        },
                        ticks: {
                            color: '#666666',
                            callback: function(value) {
                                return value + 'äºº';
                            }
                        }
                    }
                }
            }
        });

        // å‡¡ä¾‹ä½œæˆ
        const legendContainer = document.getElementById('legendContainer');
        chartData.forEach((dataset, index) => {
            const legendItem = document.createElement('div');
            legendItem.className = 'legend-item';
            legendItem.innerHTML = `
                <div class="legend-color" style="background: ${colors[index]};"></div>
                <span>${dataset.label}</span>
            `;
            legendContainer.appendChild(legendItem);
        });

        // çµ±è¨ˆã‚«ãƒ¼ãƒ‰ä½œæˆ
        const statsContainer = document.getElementById('statsContainer');
        const finalValues = membershipData.map((series, index) => {
            const validValues = series.filter(v => v !== null);
            return {
                series: index + 1,
                final: validValues[validValues.length - 1] || 0
            };
        });

        finalValues.forEach((stat, index) => {
            const statCard = document.createElement('div');
            statCard.className = 'stat-card';
            statCard.innerHTML = `
                <div class="stat-number">${stat.final}</div>
                <div class="stat-label">${companyNames[index]} æœ€çµ‚å…¥ä¼šæ•°</div>
            `;
            statsContainer.appendChild(statCard);
        });

        // ç·è¨ˆã‚«ãƒ¼ãƒ‰
        const totalCard = document.createElement('div');
        totalCard.className = 'stat-card';
        const total = finalValues.reduce((sum, stat) => sum + stat.final, 0);
        totalCard.innerHTML = `
            <div class="stat-number">${total}</div>
            <div class="stat-label">å…¨ç³»åˆ—åˆè¨ˆå…¥ä¼šæ•°</div>
        `;
        statsContainer.appendChild(totalCard);

        // æœŸé–“åˆ¥åˆ†æè¡¨ç¤º
        const periodAnalysis = document.getElementById('periodAnalysis');
        const growthResults = calculatePeriodGrowth();

        growthResults.forEach(period => {
            const periodCard = document.createElement('div');
            periodCard.className = 'period-card';
            
            let cardContent = `<div class="period-title">${period.name}</div>`;
            
            period.series.forEach(series => {
                cardContent += `
                    <div class="growth-stat">
                        <span>${series.companyName}</span>
                        <span>${series.growth}äººå¢—åŠ  (${series.growthRate}%)</span>
                    </div>
                `;
            });

            // å¹³å‡å¢—åŠ äººæ•°è¨ˆç®—
            const avgGrowthNumber = period.series.length > 0 
                ? Math.round(period.series.reduce((sum, s) => sum + s.growth, 0) / period.series.length)
                : 0;

            cardContent += `
                <div class="highlight">
                    å¹³å‡å¢—åŠ äººæ•°: ${avgGrowthNumber}äºº
                </div>
            `;

            periodCard.innerHTML = cardContent;
            periodAnalysis.appendChild(periodCard);
        });
    </script>
</body>
</html>
